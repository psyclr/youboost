# Order Service

–°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ SMM-—É—Å–ª—É–≥.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

Order Service –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:

- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ SMM-—É—Å–ª—É–≥–∏
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∑–∞–∫–∞–∑–æ–≤ –∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –û–±—Ä–∞–±–æ—Ç–∫—É –æ—Ç–º–µ–Ω –∏ —Ä–µ—Ñ–∞–Ω–¥–æ–≤
- –ß–∞—Å—Ç–∏—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- **PostgreSQL** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –∏ –∏—Ö –∏—Å—Ç–æ—Ä–∏–∏
- **Redis** - –æ—á–µ—Ä–µ–¥–∏ –∑–∞–∫–∞–∑–æ–≤ –∏ –∫—ç—à —Å—Ç–∞—Ç—É—Å–æ–≤
- **Auth Service** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- **Billing Service** - freeze/charge —Å—Ä–µ–¥—Å—Ç–≤
- **Provider Adapter** - –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º

### –í–Ω–µ—à–Ω–∏–µ API

- Notification Service (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ)

## üöÄ API Endpoints

### POST /orders

–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞.

**Request:**

```json
{
  "serviceId": "youtube_views",
  "link": "https://youtube.com/watch?v=xxx",
  "quantity": 1000,
  "comments": "Optional comments"
}
```

**Response:**

```json
{
  "orderId": "uuid",
  "serviceId": "youtube_views",
  "status": "pending",
  "quantity": 1000,
  "startCount": 5432,
  "price": 5.0,
  "createdAt": "2024-01-01T10:00:00Z",
  "estimatedCompletion": "2024-01-02T10:00:00Z"
}
```

### GET /orders/:id

–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–∫–∞–∑–µ.

**Response:**

```json
{
  "orderId": "uuid",
  "serviceId": "youtube_views",
  "status": "in_progress",
  "quantity": 1000,
  "completed": 450,
  "startCount": 5432,
  "remains": 550,
  "price": 5.0,
  "createdAt": "2024-01-01T10:00:00Z",
  "updatedAt": "2024-01-01T15:00:00Z"
}
```

### GET /orders

–°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Query Parameters:**

- `page`: –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (default: 1)
- `limit`: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π (default: 20, max: 100)
- `status`: —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É (pending, in_progress, completed, cancelled)
- `serviceId`: —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É —É—Å–ª—É–≥–∏

**Response:**

```json
{
  "orders": [
    {
      "orderId": "uuid",
      "serviceId": "youtube_views",
      "status": "in_progress",
      "quantity": 1000,
      "completed": 450,
      "price": 5.0,
      "createdAt": "2024-01-01T10:00:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 45
  }
}
```

### DELETE /orders/:id

–û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞ (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ).

**Response:**

```json
{
  "orderId": "uuid",
  "status": "cancelled",
  "refundAmount": 2.5,
  "cancelledAt": "2024-01-01T16:00:00Z"
}
```

## üìä –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤

### Lifecycle

1. **pending** - –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω, —Å—Ä–µ–¥—Å—Ç–≤–∞ –∑–∞–º–æ—Ä–æ–∂–µ–Ω—ã
2. **processing** - –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É
3. **in_progress** - –ó–∞–∫–∞–∑ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
4. **completed** - –ó–∞–∫–∞–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é
5. **partial** - –ó–∞–∫–∞–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω —á–∞—Å—Ç–∏—á–Ω–æ
6. **cancelled** - –ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω
7. **refunded** - –°—Ä–µ–¥—Å—Ç–≤–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã

### Transitions

```
pending -> processing -> in_progress -> completed
                      -> partial
                      -> cancelled -> refunded
```

## üîÑ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### Order Validation

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —É—Å–ª—É–≥–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ/–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ quantity
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### Provider Selection

- –í—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ:
  - –ù–∞–ª–∏—á–∏—è —É—Å–ª—É–≥–∏
  - –¶–µ–Ω—ã
  - Reliability score
  - –¢–µ–∫—É—â–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏

### Partial Completion

- –ï—Å–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –≤—ã–ø–æ–ª–Ω–∏–ª < 100%, —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—É–º–º–∞
- –í–æ–∑–≤—Ä–∞—Ç –æ—Å—Ç–∞—Ç–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å

### Cancellation Policy

- **pending**: –ø–æ–ª–Ω—ã–π refund
- **processing**: –ø–æ–ª–Ω—ã–π refund (–µ—Å–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–µ –Ω–∞—á–∞–ª)
- **in_progress**: —á–∞—Å—Ç–∏—á–Ω—ã–π refund (–∑–∞ –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é —á–∞—Å—Ç—å)
- **completed**: refund –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit Tests

```bash
npm test -- services/order-service
```

### Integration Tests

```bash
npm run test:integration -- order-service
```

### Test Coverage Target

- **–ú–∏–Ω–∏–º—É–º**: 85%
- **–¶–µ–ª—å**: 90%

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
- –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –∑–∞–∫–∞–∑–∞
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- Success rate –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- Refund rate

### Alerts

- –ó–∞–∫–∞–∑ –≤–∏—Å–∏—Ç –≤ pending > 5 –º–∏–Ω—É—Ç
- Spike –≤ cancelled orders
- Provider –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç > 30 —Å–µ–∫—É–Ω–¥

## üöß –°—Ç–∞—Ç—É—Å

**–í–µ—Ä—Å–∏—è**: 0.0.0 (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π (core —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã)

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [API Specification](../../docs/api/order-service.yaml)
- [Order Flow](../../docs/architecture/order-flow.md)
- [Provider Integration](../../docs/architecture/provider-integration.md)

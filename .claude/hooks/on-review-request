#!/bin/bash
# Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€Ð¸Ñ‚ÑÑ ÐºÐ¾Ð³Ð´Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ /codex-review

FILES_TO_REVIEW=$@

echo "ðŸ” Starting code review for: $FILES_TO_REVIEW"

# 1. Ð—Ð°Ð¿ÑƒÑÐº ÑÑ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð°Ð½Ð°Ð»Ð¸Ð·Ð°Ñ‚Ð¾Ñ€Ð¾Ð²
echo "ðŸ“ Running ESLint..."
npx eslint $FILES_TO_REVIEW 2>/dev/null || echo "âš ï¸  Lint check failed"

echo "ðŸ”§ Type checking..."
npx tsc --noEmit 2>/dev/null || echo "âš ï¸  Type check failed"

# 2. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° test coverage Ð´Ð»Ñ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
echo "ðŸ§ª Checking test coverage..."
for file in $FILES_TO_REVIEW; do
    TEST_FILE="${file%.ts}.test.ts"
    if [[ ! -f $TEST_FILE ]]; then
        echo "âš ï¸  Missing test file: $TEST_FILE"
    fi
done

# 3. Security scan
echo "ðŸ”’ Security audit..."
npm audit 2>/dev/null || echo "âš ï¸  Security audit failed"

# 4. Complexity analysis
echo "ðŸ“Š Complexity analysis..."
npx eslint $FILES_TO_REVIEW --format json 2>/dev/null | jq '.[] | select(.messages[].ruleId == "complexity")' 2>/dev/null || true

echo ""
echo "âœ… Code review checks completed"
